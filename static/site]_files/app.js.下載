const locales = ['en', 'zh-CN', 'ja', 'ko', 'zh-TW', 'ru', 'es', 'tr', 'fr', 'de', 'pt']

function getCookie(cookieName) {
    var arg = cookieName + '='
    var alen = arg.length
    var clen = document.cookie.length
    var i = 0
    while (i < clen) {
        var j = i + alen
        if (document.cookie.substring(i, j) == arg) {
            var endstr = document.cookie.indexOf(';', j)
            if (endstr == -1) {
                endstr = document.cookie.length
            }
            var ret = unescape(document.cookie.substring(j, endstr))
            if (ret != '') {
                return ret
            }
        }
        i = document.cookie.indexOf(' ', i) + 1
        if (i == 0) break
    }
    return ''
}

function getCookieLang() {
    let data = getCookie('BITGET_LOCAL_COOKIE') ? JSON.parse(getCookie('BITGET_LOCAL_COOKIE')) : ''
    if (data) {
        return data['bitget_lang']
    }
    return 'en'
}

// 判断ie版本方法
window.IEVersion = (function() {
    var userAgent = navigator.userAgent // 取得浏览器的userAgent字符串
    var isIE = userAgent.indexOf('compatible') > -1 && userAgent.indexOf('MSIE') > -1 // 判断是否IE<11浏览器
    var isEdge = userAgent.indexOf('Edge') > -1 && !isIE // 判断是否IE的Edge浏览器
    var isIE11 = userAgent.indexOf('Trident') > -1 && userAgent.indexOf('rv:11.0') > -1
    if (isIE) {
        var reIE = new RegExp('MSIE (\\d+\\.\\d+);')
        reIE.test(userAgent)
        var fIEVersion = parseFloat(RegExp['$1'])
        if (fIEVersion == 7) {
            return 7
        } else if (fIEVersion == 8) {
            return 8
        } else if (fIEVersion == 9) {
            return 9
        } else if (fIEVersion == 10) {
            return 10
        } else {
            return 6 // IE版本<=7
        }
    } else if (isEdge) {
        return 'edge' // edge
    } else if (isIE11) {
        return 11 // IE11
    } else {
        return -1 // 不是ie浏览器
    }
})()

// 设置zendesk
function setLanguage() {
    zE(function() {
        var localLang = getCookieLang()
        if (localLang == 'zh-cn') {
            localLang = 'zh-CN'
        }
        zE('webWidget', 'setLocale', localLang)
        zE('webWidget', 'chat:removeTags', locales)
        zE('webWidget', 'chat:addTags', localLang)
        zE('webWidget', 'helpCenter:setSuggestions', { search: 'bitget' })
    })
}
window.zESettings = {
    webWidget: {
        // answerBot:{
        //   suppress:true
        // },
        launcher: {
            chatLabel: {
                'en-US': 'chat',
                ja: 'サービス',
                vi: 'chat',
                ru: 'Поддержка',
                '*': '在线客服'
            }
        },
        chat: {
            title: {
                'en-US': 'chat',
                ja: 'ヘルプ',
                vi: 'Chat',
                ru: 'Поддержка',
                '*': '在线客服'
            },
            concierge: {
                title: {
                    'en-US': 'Welcome to BG',
                    ja: 'ようこそ  BG',
                    vi: 'Chào mừng đến với BG',
                    ru: 'Добро пожаловать в BG',
                    '*': '欢迎光临BG'
                }
            }
        }
    }
}
// 展示全局loading
window.onload = function() {
    if (
        location.href.indexOf('trade') == -1 &&
        location.href.indexOf('swap') == -1 &&
        location.href.indexOf('game') == -1 &&
        location.href.indexOf('act_new') == -1
    ) {
        var script = document.createElement('script')
        script.type = 'text/javascript'
        script.id = 'ze-snippet'
        script.src =
            'https://static.zdassets.com/ekr/snippet.js?key=cf2883af-b35a-4d25-81f9-78acb3ccf913'
        if (script.readyState) {
            script.onreadystatechange = function() {
                if (script.readyState == 'loaded' || script.readyState == 'complete') {
                    script.onreadystatechange = null
                    setLanguage()
                }
            }
        } else {
            script.onload = function() {
                setLanguage()
            }
        }
        document.getElementsByTagName('head')[0].appendChild(script)
    }
}
