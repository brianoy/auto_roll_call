(window.webpackJsonp=window.webpackJsonp||[]).push([[357],{2500:function(e,t,n){"use strict";var r=n(15),o=n(60),l=n(55),c=n(56),h=n(39),d=n(0),f=n(1);d(t,"__esModule",{value:!0}),t.default=void 0;var v=f(n(98)),y=f(n(30)),m=f(n(10)),k=f(n(11)),w=f(n(603)),_=f(n(16)),P=f(n(17)),D=f(n(14)),T=f(n(4)),C=f(n(2711));function M(e,t){var n=void 0!==l&&e[c]||e["@@iterator"];if(!n){if(h(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return I(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return o(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return I(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var d,f=!0,v=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return f=e.done,e},e:function(e){v=!0,d=e},f:function(){try{f||null==n.return||n.return()}finally{if(v)throw d}}}}function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function N(e){var t=function(){if("undefined"==typeof Reflect||!r)return!1;if(r.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(r(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=(0,D.default)(e);if(t){var l=(0,D.default)(this).constructor;n=r(o,arguments,l)}else n=o.apply(this,arguments);return(0,P.default)(this,n)}}var A=function(e){(0,_.default)(n,e);var t=N(n);function n(){var e;return(0,m.default)(this,n),e=t.call(this),(0,T.default)((0,w.default)(e),"readyCallbackMap",void 0),(0,T.default)((0,w.default)(e),"outPipes",void 0),e.outPipes=new v.default,e.readyCallbackMap=new v.default,e}return(0,k.default)(n,[{key:"inputPipe",value:function(e,t,n,r){var o=this;r?this.has(e)?this._ready(e,t):this.init(e,t).then((function(t){o._ready(e,t)})):this.has(e)&&this.dealNewData(e,t,n)}},{key:"_ready",value:function(e,t){var n=this.readyCallbackMap.get(e);"[object Function]"===Object.prototype.toString.call(n)&&n(t)}},{key:"outPipe",value:function(e,t){this.outPipes.set(e,t)}},{key:"deleteOutPipe",value:function(e){this.outPipes.has(e)&&this.outPipes.delete(e)}},{key:"addAndEmit",value:function(e,data){this.add(e,data),this.emit(e,data)}},{key:"emit",value:function(e,t){var n=this.outPipes.get(e);n&&n(t)}},{key:"pause",value:function(e){this.has(e)&&this.updateMeta(e,"PAUSE",!1)}},{key:"_whenCacheReady",value:function(e,t){this.readyCallbackMap.set(e,t)}},{key:"deleteWhenCacheReady",value:function(e){this.readyCallbackMap.has(e)&&this.readyCallbackMap.delete(e)}},{key:"getLastKline",value:function(e){return this.has(e)&&!this.isEmpty(e)?this.get(e).slice(-1)[0]:{}}},{key:"updateLastKline",value:function(e,t){var n=t.open,r=t.close,o=t.high,l=t.low,c=t.volume,time=t.time;if(this.has(e)&&!this.isEmpty(e)){var h=this.get(e);h.pop(),h.push({open:n,close:r,high:o,low:l,volume:c,time:time})}}},{key:"dealNewData",value:function(e,data,t){var n,r=M(data);try{for(r.s();!(n=r.n()).done;){var o=n.value;this.updateCache(e,o,t)}}catch(e){r.e(e)}finally{r.f()}this.isReady(e)||(this.updateMeta(e,"APPEND",!0),this._ready(e,this.get(e)))}},{key:"updateCache",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(new Date).getTime(),o=this.getLastKline(e),l=o.time,c=this.isReady(e);if(!o)return this.add(e,t),void(c&&this.emit(e,t));var h=r;Number(t.time)>Number(l)?Number(t.time)<=h?(this.add(e,t),c&&this.emit(e,t)):setTimeout((function(){n.add(e,t),c&&n.emit(e,t)}),t.time-h+100):Number(t.time)===Number(l)&&(this.updateLastKline(e,t),this.emit(e,t))}},{key:"outPeriodData",value:function(e,t,n){var r=this;return new y.default((function(o,l){var c=function(){o(r.getPeriodData(e,t,n))};r.isReady(e)?c():r._whenCacheReady(e,c)}))}},{key:"getPeriodData",value:function(e,t,n){var r=this.get(e),o=[],l=!1;return r.forEach((function(e){e.time>1e3*t&&((!n||e.time<=1e3*n)&&o.push((0,C.default)(e)),l=!0)})),{data:o,noData:l&&o.length<=0}}}],[{key:"getInstance",value:function(){return this.instance||(this.instance=new n),this.instance}}]),n}(n(2501).BaseCache);t.default=A,(0,T.default)(A,"instance",void 0)},2501:function(e,t,n){"use strict";var r=n(0),o=n(1);r(t,"__esModule",{value:!0}),t.BaseCache=void 0;var l=o(n(98)),c=o(n(30)),h=o(n(28)),d=o(n(10)),f=o(n(11)),v=o(n(4)),y=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;(0,d.default)(this,e),(0,v.default)(this,"cache",void 0),(0,v.default)(this,"ttl",void 0),this.cache=new l.default,this.ttl=t}return(0,f.default)(e,[{key:"updateMeta",value:function(e,t,n){var r={lastUpdateTime:(new Date).getTime(),lastAction:t};void 0!==n&&(r.ready=n),(0,h.default)(this.cache.get(e).meta,r)}},{key:"has",value:function(e){return this.cache.has(e)&&this.cache.get(e).data}},{key:"isReady",value:function(e){return this.has(e)&&this.cache.get(e).meta.ready}},{key:"isEmpty",value:function(e){return this.cache.has(e)&&0===this.cache.get(e).data.length}},{key:"add",value:function(e,data){this.has(e)&&(this.cache.get(e).data.push(data),this.updateMeta(e,"ADD"))}},{key:"get",value:function(e){return this.has(e)&&this.cache.get(e).data||[]}},{key:"init",value:function(e,t){var n=this;return new c.default((function(r,o){n.has(e)&&o("Key:".concat(e," already exists"));var time=(new Date).getTime();n.cache.set(e,{meta:{lastUpdateTime:time,createTime:time,lastAction:"INIT",ready:!0},data:t}),r(t)}))}},{key:"delete",value:function(e){this.cache.delete(e)}},{key:"truncate",value:function(e){this.has(e)&&(this.cache.get(e).data=[],this.updateMeta(e,"TRUNCATE"))}},{key:"clearAll",value:function(){this.cache=new l.default}}]),e}();t.BaseCache=y},3949:function(e,t,n){"use strict";var r=n(0),o=n(1);r(t,"__esModule",{value:!0}),t.default=t.TvIntervalToIntervalText=void 0;var l=o(n(30)),c=o(n(53)),h=o(n(10)),d=o(n(11)),f=o(n(4)),v=(n(2269),o(n(2500))),y=o(n(979)),m=v.default.getInstance();window.myCache=m;var k={1:"1m",5:"5m",15:"15m",30:"30m",60:"1H",240:"4H",720:"12H","1D":"1D","1W":"1W"};t.TvIntervalToIntervalText=k;var w=function(){function e(t,n){(0,h.default)(this,e),(0,f.default)(this,"_configuration",void 0),(0,f.default)(this,"_websocketProvider",void 0),(0,f.default)(this,"_dataPool",void 0),(0,f.default)(this,"place",void 0),this._configuration={exchange:[],supports_search:!1,supported_resolutions:["1","5","15","30","60","1D","1W"],supports_marks:!1,supports_timescale_marks:!1,supports_group_request:!0},this._websocketProvider=t,this._dataPool={},this.place=n}return(0,d.default)(e,[{key:"onReady",value:function(e){var t=this;l.default.resolve().then((function(){e(t._configuration)}))}},{key:"resolveSymbol",value:function(e,t){var n=this;l.default.resolve().then((function(){t({name:e,ticker:e,description:"",type:"stock",session:"24X7",pricescale:Number("1e"+n.place),minmov:1,timezone:"Asia/Shanghai",has_intraday:!0,has_daily:!0,has_weekly_and_monthly:!0,volumescale:Number("1e-4")})}))}},{key:"getBars",value:function(e,t,n,r,o,l,h){var d="getBars|"+(t=k[t])+"|"+e.name;h&&y.default.getInstance().subscribe("candle"+t,{instType:"sp",instId:e.name},(function(data){var e=data.data.map((function(e){return{open:+e[1],close:+e[4],high:+e[2],low:+e[3],volume:+e[5],time:Number(e[0])}}));m.inputPipe(d,e,(0,c.default)(),"snapshot"===data.action)}));m.outPeriodData(d,n,r).then((function(data){o(data.data,{noData:data.noData})}))}},{key:"subscribeBars",value:function(e,t,n){var r="getBars|"+(t=k[t])+"|"+e.name;m.outPipe(r,(function(e){n(e)}))}},{key:"unsubscribeBars",value:function(e){var t=e.split("_"),n=t[0]||"",r=t[1]||"",o="getBars|"+(r=k[String(r)])+"|"+n;m.delete(o),m.deleteWhenCacheReady(o),m.deleteOutPipe(o)}},{key:"calculateHistoryDepth",value:function(e,t,n){}},{key:"getMarks",value:function(e,t,n,r,o){}},{key:"getTimescaleMarks",value:function(e,t,n,r,o){}}]),e}();t.default=w}}]);
//# sourceMappingURL=ba7cd2962f39af4d8160.js.map