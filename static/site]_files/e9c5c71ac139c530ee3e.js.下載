(window.webpackJsonp=window.webpackJsonp||[]).push([[579],{1329:function(e,t,n){"use strict";var o=n(0),r=n(1);o(t,"__esModule",{value:!0}),t.uuid=k,t.default=void 0;var c=r(n(98)),l=r(n(6)),h=r(n(28)),f=r(n(10)),d=r(n(11)),v=r(n(4)),_=r(n(1335)),m=r(n(99)),y=n(31);var w=function(){function e(t){var n=this;(0,f.default)(this,e),this._ws=new _.default(t),this.listenerList=new c.default,this._ws.connect(),this._ws.on("ws:message",(function(e){var data=e.data;if(data)try{data=JSON.parse(data)}catch(e){console.log(e),data={}}n.dispatch(data)})),this._ws.on("ws:open",(function(){n._ws.send()})),this._ws.on("ws:send",(function(){}))}return(0,d.default)(e,[{key:"sub",value:function(e,param){var t=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},o="";if(y.type.isArray(param))param.forEach((function(o){var r=k(e,o);o.id=r,t.listenerList.has(r)?t.listenerList.get(r).push(n):t.listenerList.set(r,[n])})),o=param;else{var r=k(e,param);if(param.id=r,o=[param],this.listenerList.has(r))return void this.listenerList.get(r).push(n);this.listenerList.set(r,[n])}this._ws.send({action:e,args:o,terminaltype:"1"})}},{key:"unsub",value:function(e){var param=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=k(e,param);param.id=t,this.listenerList.has(t)&&this.listenerList.delete(t),this._ws.send({action:"unsub_"+e})}},{key:"unsubAll",value:function(){var e=this;this.clearListener();for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];n.forEach((function(t){e._ws.send({action:"unsub_"+t})}))}},{key:"dispatch",value:function(data){var e=data.action||"subscribe",t=data.id||k(e,data);this.listenerList.has(t)&&this.listenerList.get(t).forEach((function(e){e.call(null,data)}))}},{key:"clearListener",value:function(){this.listenerList.clear()}},{key:"close",value:function(){this.clearListener(),this._ws.close()}}],[{key:"getInstance",value:function(){if(e.instance)return e.instance;var t,n,o=(t=location.host.split(".").slice(1).join("."),n={url:"wss://newstream.#/v1/common/websocket".replace("#",t)},"bitget.bike"!==t&&"online"===m.default.env?n.url:m.default.otcWebSocketUrl);return e.instance=new e(o)}}]),e}();function k(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e,param=t;t.params&&(param=(0,h.default)({},t,t.params));var filter=["topic","bizNo"];return(0,l.default)(param).filter((function(e){return filter.includes(e)})).sort((function(a,b){return a<b?-1:a===b?0:1})).forEach((function(e){n+="|".concat(e,":").concat(param[e])})),n}t.default=w,(0,v.default)(w,"instance",null)},1335:function(e,t,n){"use strict";var o=n(15),r=n(0),c=n(1);r(t,"__esModule",{value:!0}),t.default=void 0;var l=c(n(44)),h=c(n(10)),f=c(n(11)),d=c(n(603)),v=c(n(16)),_=c(n(17)),m=c(n(14)),y=c(n(4));function w(e){var t=function(){if("undefined"==typeof Reflect||!o)return!1;if(o.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(o(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,m.default)(e);if(t){var c=(0,m.default)(this).constructor;n=o(r,arguments,c)}else n=r.apply(this,arguments);return(0,_.default)(this,n)}}var k=function(e){(0,v.default)(n,e);var t=w(n);function n(e){var o,option=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,h.default)(this,n),o=t.call(this),(0,y.default)((0,d.default)(o),"reconnectTime",0),o.url=e,o.option=option,o.heartCount=0,o.sendList=[],o.heartCheckTimer=null,o}return(0,f.default)(n,[{key:"connect",value:function(){var e=this;this.ws=new WebSocket(this.url);var t=this;this.ws.onopen=function(e){t.emit("ws:open"),t.emit("ws:send"),console.log("socket 已连接"),t.heartCheck()},this.ws.onmessage=function(e){t.heartCount=0,t.emit("ws:message",e)},this.ws.onerror=function(n){t.emit("error"),console.log("socket错误",n),e.reconnect("socket错误 进行重连")},this.ws.onclose=function(n){t.emit("close"),console.log("socket已关闭"),e.reconnect("socket关闭 进行重连")}}},{key:"readyState",value:function(){return this.ws?this.ws.readyState:0}},{key:"send",value:function(param){if(1==this.readyState()){if(this.sendList.length)for(;;){var e=this.sendList.shift();if(!e)break;this.ws.send((0,l.default)(e)),this.emit("ws:send",param)}param&&(this.ws.send((0,l.default)(param)),this.emit("ws:send",param))}else"ping"!==param.action&&param&&this.sendList.push(param)}},{key:"close",value:function(){this.heartCheckTimer&&(console.log("先暂停心跳检测"),clearTimeout(this.heartCheckTimer),this.heartCheckTimer=null),3!=this.readyState()&&this.ws.close(),console.log("close")}},{key:"reconnect",value:function(e){console.log(e),this.close(),this.reconnectTime++,this.reconnectTime<6?this.connect():console.log("ws 出现问题, 连不上")}},{key:"heartCheck",value:function(){this.heartCheckTimer&&(clearTimeout(this.heartCheckTimer),this.heartCheckTimer=null);var e=this;!function t(){e.heartCount>6?e.reconnect("心跳检测失败 重连"):(e.send({action:"ping",args:[{params:{}}]}),e.heartCount++,e.heartCheckTimer=setTimeout((function(){t()}),1e4))}()}}]),n}(c(n(1348)).default);t.default=k},1348:function(e,t,n){"use strict";var o=n(0),r=n(1);o(t,"__esModule",{value:!0}),t.default=void 0;var c=r(n(98)),l=r(n(10)),h=r(n(11)),f=function(){function e(){(0,l.default)(this,e),this.listenerList=new c.default}return(0,h.default)(e,[{key:"on",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};this.listenerList.has(e)&&this.listenerList.get(e).push(t),this.listenerList.set(e,[t])}},{key:"emit",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];this.listenerList.has(e)&&this.listenerList.get(e).forEach((function(e){e.apply(null,n)}))}},{key:"remove",value:function(e,t){if(e&&this.listenerList.has(e))if(!e||t){var n=this.listenerList.get(e).filter((function(e){return e!=t}));this.listenerList.set(e,n)}else this.listenerList.delete(e)}},{key:"removeAll",value:function(){this.listenerList=new c.default}}]),e}();t.default=f},1802:function(e,t,n){"use strict";var o=n(6),r=n(7),c=n(5),l=n(8),h=n(9),f=n(0),d=n(1);f(t,"__esModule",{value:!0}),t.generateId=W,t.default=void 0;var v=d(n(44)),_=d(n(98)),m=d(n(30)),y=d(n(53)),w=d(n(6)),k=d(n(10)),T=d(n(11)),E=d(n(4)),C=n(1803),O=n(1804),L=n(422);function N(object,e){var t=o(object);if(r){var n=r(object);e&&(n=n.filter((function(e){return c(object,e).enumerable}))),t.push.apply(t,n)}return t}function S(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?N(Object(source),!0).forEach((function(t){(0,E.default)(e,t,source[t])})):l?h(e,l(source)):N(Object(source)).forEach((function(t){f(e,t,c(source,t))}))}return e}var R=n(99),M={maxReconnectionDelay:1e4,minReconnectionDelay:1e3+4e3*Math.random(),reconnectionDelayGrowFactor:1.3,connectionTimeout:1e4,maxRetries:1/0,maxEnqueuedMessages:1/0,startClosed:!1,debug:"online"!==R.env,maxHeartbeat:6,heartbeatInterval:2e4,compress:R.socketCompress},I=function(){function e(t,n){var o=this;(0,k.default)(this,e),(0,E.default)(this,"version",void 0),(0,E.default)(this,"_url",void 0),(0,E.default)(this,"_options",void 0),(0,E.default)(this,"_ws",void 0),(0,E.default)(this,"_binaryType",void 0),(0,E.default)(this,"_protocols",void 0),(0,E.default)(this,"_retryCount",void 0),(0,E.default)(this,"_heartbeats",void 0),(0,E.default)(this,"_closeCalled",void 0),(0,E.default)(this,"_shouldReconnect",void 0),(0,E.default)(this,"_connectLock",void 0),(0,E.default)(this,"_connectTimeout",void 0),(0,E.default)(this,"_beatTimeout",void 0),(0,E.default)(this,"_messageQueue",void 0),(0,E.default)(this,"_listeners",void 0),(0,E.default)(this,"_channelMap",void 0),(0,E.default)(this,"productCode",void 0),(0,E.default)(this,"urlManager",void 0),(0,E.default)(this,"_handleOpen",(function(e){clearTimeout(o._connectTimeout),o._heartbeats=0,o._retryCount=0,o._debug("deal message queue:",(0,v.default)(o._messageQueue)),o._messageQueue.forEach((function(e){return o._ws.send(e)})),o._messageQueue=[],o._heartbeat(),o._listeners.open.forEach((function(t){return t(e)}))})),(0,E.default)(this,"_handleClose",(function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];o._clearTimeouts(),t&&o._connect(),o._listeners.close.forEach((function(t){return t(e)}))})),(0,E.default)(this,"_handleMessage",(function(e){var t=e.data;o._heartbeats=0,o._options.compress?o._inflateMessage(t):o._dispatchMessage(t)})),this._url=t,this._options=n,this._init()}return(0,T.default)(e,[{key:"begin",value:function(e){this.changeProduct(e),this._connect()}},{key:"changeProduct",value:function(e){this.productCode=e}},{key:"_init",value:function(){this.version="2.0",this._binaryType="blob",this._protocols="",this._retryCount=-1,this._heartbeats=0,this._closeCalled=!1,this._connectLock=!1,this._connectTimeout=null,this._messageQueue=[],this._shouldReconnect=!0,this._listeners={open:new _.default,close:new _.default,error:new _.default,message:new _.default},this._channelMap=new _.default}},{key:"CONNECTING",get:function(){return e.CONNECTING}},{key:"OPEN",get:function(){return e.OPEN}},{key:"CLOSING",get:function(){return e.CLOSING}},{key:"CLOSED",get:function(){return e.CLOSED}},{key:"retryCount",get:function(){return Math.max(this._retryCount,0)}},{key:"readyState",get:function(){return this._ws?this._ws.readyState:this._options.startClosed?e.CLOSED:e.CONNECTING}},{key:"_inflateMessage",value:function(e){if(e instanceof Blob){var t=new FileReader,n=this;t.addEventListener("loadend",(function(){var e=(0,L.inflate)(t.result,{to:"string"});n._dispatchMessage(e)})),t.onerror=function(e){console.log("解压出现问题",e)},t.readAsArrayBuffer(e)}else this._dispatchMessage(e)}},{key:"_dispatchMessage",value:function(e){var data=JSON.parse(String(e)),t=W(data.action,data);this._listeners.message.forEach((function(e){return e(data,t)}))}},{key:"_handleError",value:function(e){this._debug("error event",e.message),this._disconnect(void 0,"TIMEOUT"===e.message?"timeout":void 0),this._listeners.error.forEach((function(t){return t(e)})),this._connect()}},{key:"_handleTimeout",value:function(){this._debug("timeout event"),this._handleError(new O.WrappedErrorEvent(null,O.TIMEOUT_ERROR,this))}},{key:"_initListeners",value:function(){var e=this;this._ws&&(this._ws.onopen=this._handleOpen,this._ws.onclose=function(t){var n=new O.WrappedCloseEvent(t);n.target=e,e._handleClose(n,"terminate"!==n.reason)},this._ws.onmessage=this._handleMessage,this._ws.onerror=function(t){e._handleError(new O.WrappedErrorEvent(t,O.CONNECTION_ERROR,e))})}},{key:"_removeListeners",value:function(){this._ws&&(this._debug("removeListeners"),this._ws.onclose=U,this._ws.onopen=U,this._ws.onerror=U,this._ws.onmessage=U)}},{key:"_wait",value:function(){return new m.default((function(e){setTimeout(e,1e3)}))}},{key:"_getNextUrl",value:function(e){if("string"==typeof e)return m.default.resolve(e);if("function"==typeof e){var t=e(this._options.compress);if("string"==typeof t)return m.default.resolve(t);if(t.then)return t}throw Error("Invalid URL")}},{key:"_connect",value:function(){var e=this;if(!this._connectLock&&this._shouldReconnect){this._connectLock=!0;var t=this._options,n=t.maxRetries,o=void 0===n?M.maxRetries:n,r=t.connectionTimeout,c=void 0===r?M.connectionTimeout:r;this._retryCount>=o?this._debug("max retries reached",this._retryCount,">=",o):(this._retryCount++,this._debug("connect retryCount:",this._retryCount),this._removeListeners(),this._wait().then((function(){return e._getNextUrl(e._url)})).then((function(t){e._closeCalled||(e._ws=e._protocols?new WebSocket(t,e._protocols):new WebSocket(t),e._connectLock=!1,e._initListeners(),e._connectTimeout=setTimeout((function(){return e._handleTimeout()}),c))})))}}},{key:"_disconnect",value:function(){var code=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,e=arguments.length>1?arguments[1]:void 0;if(this._clearTimeouts(),this._ws){this._removeListeners();try{this._ws.close(code,e);var t=new O.WrappedCloseEvent(null,code,e);t.target=this,this._handleClose(t)}catch(e){}}}},{key:"_heartbeat",value:function(){var e=this;this._beatTimeout&&clearTimeout(this._beatTimeout);!function t(){var n=e._options,o=n.maxHeartbeat,r=void 0===o?M.maxHeartbeat:o,c=n.heartbeatInterval,l=void 0===c?M.heartbeatInterval:c;e._heartbeats>r?e.reconnect(4999,"heartbeat"):(e._ws.send((0,v.default)({action:"ping"})),e._heartbeats++,e._beatTimeout=setTimeout((function(){t()}),l))}()}},{key:"close",value:function(){var code=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,e=arguments.length>1?arguments[1]:void 0;this._closeCalled=!0,this._shouldReconnect=!1,this._clearTimeouts(),this._ws?this._ws.readyState!==this.CLOSED?this._ws.close(code,e):this._debug("close: already closed"):this._debug("close enqueued: no ws instance")}},{key:"terminate",value:function(){this.close(1e3,"terminate"),this._debug("execute termination"),e.instance=null,this._init()}},{key:"reconnect",value:function(code,e){this._shouldReconnect=!0,this._closeCalled=!1,this._retryCount=-1,this._ws&&this._ws.readyState!==this.CLOSED?(this._disconnect(code,e),this._connect()):this._connect()}},{key:"_debug",value:function(){if(this._options.debug){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];console.log.apply(console,["hero says>"].concat(t))}}},{key:"_clearTimeouts",value:function(){clearTimeout(this._connectTimeout),clearTimeout(this._beatTimeout)}},{key:"registerEventListener",value:function(t,n){var o=t+String((0,y.default)());return this._listeners[t].set(o,n),"open"===t&&this.readyState===e.OPEN&&n(),o}},{key:"removeEventListener",value:function(e,t){this._listeners[e].delete(t)}},{key:"send",value:function(data){this._ws&&this._ws.readyState===this.OPEN?this._ws.send(data):(this._debug("enqueue",data),this._messageQueue.push(data))}},{key:"subscribe",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;n instanceof Function&&(o=n,n={});var r=W(e,n);this._listeners.message.get(r)&&this._listeners.message.delete(r),this._listeners.message.set(r,(function(e,n){e.productCode&&e.productCode!==t.productCode&&""!=t.productCode||n===r&&o(e,n)}));var c="message"+String((0,y.default)());return this.send((0,v.default)(S(S({action:e},n),{},{msgId:c}))),r+"#"+c}},{key:"unsubscribe",value:function(e){this._listeners.message=new _.default}},{key:"unsubscribeAll",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(!(t.length<=0))for(var o=0,r=t;o<r.length;o++){var c=r[o];this.send((0,v.default)({action:"unsub_"+c.split("|")[0]}))}}},{key:"selfDestruct",value:function(){this.terminate(),this.urlManager&&this.urlManager.stop()}}],[{key:"getInstance",value:function(){if(e.instance)return e.instance;var t=new C.UrlManager,n=new e(R.socketReport?t.urlProvider:R.newWebSocketUrl,M);return e.instance=n,n.urlManager=t,n}},{key:"CONNECTING",get:function(){return 0}},{key:"OPEN",get:function(){return 1}},{key:"CLOSING",get:function(){return 2}},{key:"CLOSED",get:function(){return 3}}]),e}();function U(){}t.default=I,(0,E.default)(I,"instance",void 0);var x=["step","productCode"];function W(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("currentTraceOrders"===e)return e;var n=e;return(0,w.default)(t).sort((function(a,b){return a<b?-1:a===b?0:1})).forEach((function(e){x.indexOf(e)>-1&&(n+="|".concat(e,":").concat(t[e]))})),n}},1803:function(e,t,n){"use strict";var o=n(60),r=n(55),c=n(56),l=n(39),h=n(6),f=n(7),d=n(5),v=n(8),_=n(9),m=n(0),y=n(1);m(t,"__esModule",{value:!0}),t.UrlManager=void 0;var w=y(n(53)),k=y(n(44)),T=y(n(30)),E=y(n(76)),C=y(n(10)),O=y(n(11)),L=y(n(4));function N(object,e){var t=h(object);if(f){var n=f(object);e&&(n=n.filter((function(e){return d(object,e).enumerable}))),t.push.apply(t,n)}return t}function S(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?N(Object(source),!0).forEach((function(t){(0,L.default)(e,t,source[t])})):v?_(e,v(source)):N(Object(source)).forEach((function(t){m(e,t,d(source,t))}))}return e}function R(e,t){var n=void 0!==r&&e[c]||e["@@iterator"];if(!n){if(l(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return M(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return o(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return M(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,h=function(){};return{s:h,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:h}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,d=!0,v=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return d=e.done,e},e:function(e){v=!0,f=e},f:function(){try{d||null==n.return||n.return()}finally{if(v)throw f}}}}function M(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}var I=n(99),U=function(){function e(){var t=this;(0,C.default)(this,e),(0,L.default)(this,"records",void 0),(0,L.default)(this,"counter",void 0),(0,L.default)(this,"urlProvider",(function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];t.evaluateTask();var n=x(t.records,(function(i){return Number(i.cost)}),(function(i){return Number(i.lastUsedTime)}))||t.records[0];n.lastUsedTime=(0,w.default)();var o=n.socketUrl;return e&&(o=o+(o.indexOf("?")>-1?"&":"?")+"compress=true"),o})),(0,L.default)(this,"evaluateTask",(function(){t.counter&&clearTimeout(t.counter);!function e(){t.evaluate(),t.counter=setTimeout(e,18e5)}()}));var n=JSON.parse(localStorage.getItem("bitget::socket::score")||"[]"),o=[],r=location.host.replace("www.",""),c={name:"new-prod-3",socketUrl:"wss://contract-websocket.#/websocket".replace("#",r)};"beta"===I.env&&(c.socketUrl=c.socketUrl+"?beta=true"),"bitget.com"===r?(o.push(c),o.push.apply(o,(0,E.default)(I.backupSocketUrl))):"bitget.cc"===r||"bitget.me"===r||"bitget.io"===r?(o.push.apply(o,(0,E.default)(I.backupSocketUrl)),o.push(c)):o.push.apply(o,(0,E.default)(I.backupSocketUrl)),this.records=function(e,t){var n,o=[],r=R(e);try{var c=function(){var e=n.value,r=t.find((function(i){return i.name===e.name}));r?o.push(r):o.push(S(S({},e),{},{cost:-1,lastTestTime:-1,lastUsedTime:-1}))};for(r.s();!(n=r.n()).done;)c()}catch(e){r.e(e)}finally{r.f()}return o}(o,n)}return(0,O.default)(e,[{key:"saveRecord",value:function(){localStorage.setItem("bitget::socket::score",(0,k.default)(this.records))}},{key:"evaluate",value:function(){var e=this,t=this.records.map((function(e){return t=e,new T.default((function(e){var n=(0,w.default)(),o=new WebSocket(t.socketUrl+(t.socketUrl.indexOf("?")>-1?"&":"?")+"check=1"),r=null,c=!1,l=!1,h=setTimeout((function(){l=!0,t.lastTestTime=(0,w.default)(),t.cost=99999,e()}),4e3);o.onopen=function(){l?o.close():(clearTimeout(h),r=setTimeout((function(){o&&o.readyState===o.OPEN&&o.close()}),1e4))},o.onerror=function(){l||(t.cost=99999,t.lastTestTime=(0,w.default)(),r&&clearTimeout(r),h&&clearTimeout(h),e())},o.onmessage=function(){if(!l){var o=(0,w.default)();t.lastTestTime=o,t.cost=o-n,c=!0,e()}},o.onclose=function(){l||c||(t.lastTestTime=(0,w.default)(),t.cost=99999,e())}}));var t}));T.default.all(t).then((function(){e.saveRecord()}))}},{key:"stop",value:function(){this.counter&&clearTimeout(this.counter)}}]),e}();function x(e,t,n){if(e&&!(e.length<0)){var o=e[0];return e.forEach((function(e){var r=t(e),c=n(e);r>0&&(r<t(o)||r===t(o)&&c<n(o))&&(o=e)})),o}}t.UrlManager=U},1804:function(e,t,n){"use strict";var o=n(0),r=n(1);o(t,"__esModule",{value:!0}),t.WrappedCloseEvent=t.WrappedErrorEvent=t.CONNECTION_ERROR=t.TIMEOUT_ERROR=void 0;var c=r(n(10)),l=r(n(4));t.TIMEOUT_ERROR="TIMEOUT";t.CONNECTION_ERROR="SYSTEM";t.WrappedErrorEvent=function e(t,n,o){(0,c.default)(this,e),(0,l.default)(this,"event",void 0),(0,l.default)(this,"message",void 0),(0,l.default)(this,"target",void 0),this.event=t,this.message=n,this.target=o};t.WrappedCloseEvent=function e(t,code,n){(0,c.default)(this,e),(0,l.default)(this,"code",void 0),(0,l.default)(this,"reason",void 0),(0,l.default)(this,"wasClean",void 0),(0,l.default)(this,"event",void 0),(0,l.default)(this,"target",void 0),this.event=t,this.code=t?t.code:code||1e3,this.reason=t?t.reason:n||"",this.wasClean=!t||t.wasClean,this.target=null}},1805:function(e,t,n){"use strict";n(60),n(55),n(56),n(39),n(6),n(7),n(5),n(8),n(9);var o=n(0),r=n(1);o(t,"__esModule",{value:!0}),t.default=void 0;var c=r(n(44)),l=r(n(53)),h=r(n(30)),f=r(n(10)),d=r(n(11)),v=r(n(4));var _=n(99);function m(e,t,n){if(e&&!(e.length<0)){var o=e[0];return e.forEach((function(e){var r=t(e),c=n(e);r>0&&(r<t(o)||r===t(o)&&c<n(o))&&(o=e)})),o}}var y=function(){function e(){(0,f.default)(this,e),(0,v.default)(this,"records",void 0),(0,v.default)(this,"url",void 0),(0,v.default)(this,"counter",void 0);JSON.parse(localStorage.getItem("bitget::socket::score")||"[]");var t=location.href.indexOf("spot")>-1?_.webSocketUrl:_.newMixSocketUrl,n=location.host.split(".").slice(1).join("."),o=location.href.indexOf("spot")>-1?"wss://newstream.#/spot/v1/stream".replace("#",n):"wss://newstream.#/mix/v1/stream".replace("#",n);"bitget.bike"!==n&&"online"===_.env&&(t=o+"?compress=true"),this.url=t}return(0,d.default)(e,[{key:"saveRecord",value:function(){localStorage.setItem("bitget::socket::score",(0,c.default)(this.records))}},{key:"urlProvider",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.evaluateTask();var t=m(this.records,(function(i){return Number(i.cost)}),(function(i){return Number(i.lastUsedTime)}))||this.records[0];t.lastUsedTime=(0,l.default)();var n=t.socketUrl;return e&&(n=n+(n.indexOf("?")>-1?"&":"?")+"compress=true"),n}},{key:"evaluateTask",value:function(){var e=this;this.counter&&clearTimeout(this.counter);!function t(){e.evaluate(),e.counter=setTimeout(t,18e5)}()}},{key:"evaluate",value:function(){var e=this,t=this.records.map((function(e){return t=e,new h.default((function(e){var n=(0,l.default)(),o=new WebSocket(t.socketUrl+(t.socketUrl.indexOf("?")>-1?"&":"?")+"check=1"),r=null,c=!1,h=!1,f=setTimeout((function(){h=!0,t.lastTestTime=(0,l.default)(),t.cost=99999,e()}),4e3);o.onopen=function(){h?o.close():(clearTimeout(f),r=setTimeout((function(){o&&o.readyState===o.OPEN&&o.close()}),1e4))},o.onerror=function(){h||(t.cost=99999,t.lastTestTime=(0,l.default)(),r&&clearTimeout(r),f&&clearTimeout(f),e())},o.onmessage=function(){if(!h){var o=(0,l.default)();t.lastTestTime=o,t.cost=o-n,c=!0,e()}},o.onclose=function(){h||c||(t.lastTestTime=(0,l.default)(),t.cost=99999,e())}}));var t}));h.default.all(t).then((function(){e.saveRecord()}))}},{key:"stop",value:function(){this.counter&&clearTimeout(this.counter)}}]),e}();t.default=y},1806:function(e,t,n){"use strict";var o=n(0),r=n(1);o(t,"__esModule",{value:!0}),t.WrappedCloseEvent=t.WrappedErrorEvent=t.CONNECTION_ERROR=t.TIMEOUT_ERROR=void 0;var c=r(n(10)),l=r(n(4));t.TIMEOUT_ERROR="TIMEOUT";t.CONNECTION_ERROR="SYSTEM";t.WrappedErrorEvent=function e(t,n,o){(0,c.default)(this,e),(0,l.default)(this,"event",void 0),(0,l.default)(this,"message",void 0),(0,l.default)(this,"target",void 0),this.event=t,this.message=n,this.target=o};t.WrappedCloseEvent=function e(t,code,n){(0,c.default)(this,e),(0,l.default)(this,"code",void 0),(0,l.default)(this,"reason",void 0),(0,l.default)(this,"wasClean",void 0),(0,l.default)(this,"event",void 0),(0,l.default)(this,"target",void 0),this.event=t,this.code=t?t.code:code||1e3,this.reason=t?t.reason:n||"",this.wasClean=!t||t.wasClean,this.target=null}},979:function(e,t,n){"use strict";(function(e){var o=n(6),r=n(7),c=n(5),l=n(8),h=n(9),f=n(0),d=n(1);f(t,"__esModule",{value:!0}),t.generateId=I,t.default=void 0;var v=d(n(98)),_=d(n(30)),m=d(n(53)),y=d(n(44)),w=d(n(76)),k=d(n(10)),T=d(n(11)),E=d(n(4)),C=d(n(1805)),O=n(1806),L=n(422);function N(object,e){var t=o(object);if(r){var n=r(object);e&&(n=n.filter((function(e){return c(object,e).enumerable}))),t.push.apply(t,n)}return t}n(99);var S={maxReconnectionDelay:1e4,minReconnectionDelay:1e3+4e3*Math.random(),reconnectionDelayGrowFactor:1.3,connectionTimeout:1e4,maxRetries:1/0,maxEnqueuedMessages:1/0,startClosed:!1,debug:"online"!==e.env.REACT_APP_ENV,maxHeartbeat:6,heartbeatInterval:2e4,compress:!!e.env.socketCompress};function R(){}var M=function(){function e(t,n){var o=this;(0,k.default)(this,e),(0,E.default)(this,"_url",void 0),(0,E.default)(this,"_options",void 0),(0,E.default)(this,"_ws",void 0),(0,E.default)(this,"_binaryType",void 0),(0,E.default)(this,"_protocols",void 0),(0,E.default)(this,"_retryCount",void 0),(0,E.default)(this,"_heartbeats",void 0),(0,E.default)(this,"_closeCalled",void 0),(0,E.default)(this,"_shouldReconnect",void 0),(0,E.default)(this,"_connectLock",void 0),(0,E.default)(this,"_connectTimeout",void 0),(0,E.default)(this,"_beatTimeout",void 0),(0,E.default)(this,"_messageQueue",void 0),(0,E.default)(this,"_listeners",void 0),(0,E.default)(this,"_channelMap",void 0),(0,E.default)(this,"productCode",void 0),(0,E.default)(this,"urlManager",void 0),(0,E.default)(this,"onLogin",void 0),(0,E.default)(this,"isLogin",void 0),(0,E.default)(this,"_handleOpen",(function(e){clearTimeout(o._connectTimeout),o._heartbeats=0,o._retryCount=0,o._debug("send queued message:",o._messageQueue.length),o._messageQueue.forEach((function(e){return o._ws.send(e)})),o._messageQueue=[],o._heartbeat(),o._listeners.open.forEach((function(t){return t(e)}))})),(0,E.default)(this,"_handleClose",(function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];o._clearTimeouts(),o._listeners.close.forEach((function(t){return t(e)})),t&&o._connect(),o.isLogin=!1})),(0,E.default)(this,"_handleMessage",(function(e){var t=e.data;o._heartbeats=0,window.stopDispatchMessage||(o._options.compress||t instanceof Blob?o._inflateMessage(t):o._dispatchMessage(t))})),this._url=t,this._options=n,this._init()}return(0,T.default)(e,[{key:"CONNECTING",get:function(){return e.CONNECTING}},{key:"OPEN",get:function(){return e.OPEN}},{key:"CLOSING",get:function(){return e.CLOSING}},{key:"CLOSED",get:function(){return e.CLOSED}},{key:"_init",value:function(){this._binaryType="blob",this._protocols="",this._retryCount=-1,this._heartbeats=0,this._closeCalled=!1,this._connectLock=!1,this._connectTimeout=null,this._messageQueue=[],this._shouldReconnect=!0,this._listeners={open:new v.default,close:new v.default,error:new v.default,message:new v.default},this._channelMap=new v.default,this.onLogin=[],this.isLogin=!1}},{key:"_connect",value:function(){var e=this;if(!this._connectLock&&this._shouldReconnect){this._connectLock=!0;var t=this._options,n=t.maxRetries,o=void 0===n?S.maxRetries:n,r=t.connectionTimeout,c=void 0===r?S.connectionTimeout:r;this._retryCount>=o?this._debug("max retries reached",this._retryCount,">=",o):(this._retryCount++,this._debug("connect retryCount:",this._retryCount),this._removeListeners(),this._wait().then((function(){return e._getNextUrl(e._url)})).then((function(t){e._closeCalled||(e._ws=e._protocols?new WebSocket(t,e._protocols):new WebSocket(t),e._connectLock=!1,e._initListeners(),e._connectTimeout=setTimeout((function(){return e._handleTimeout()}),c))})))}}},{key:"_disconnect",value:function(){var code=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,e=arguments.length>1?arguments[1]:void 0;if(this._clearTimeouts(),this._ws){this._removeListeners();try{this._ws.close(code,e);var t=new O.WrappedCloseEvent(null,code,e);t.target=this,this._handleClose(t)}catch(e){}}}},{key:"_initListeners",value:function(){var e=this;this._ws&&(this._ws.onopen=this._handleOpen,this._ws.onclose=function(t){var n=new O.WrappedCloseEvent(t);n.target=e,e._debug("close event:",t.code,t.reason),e._handleClose(n,"terminate"!==n.reason)},this._ws.onmessage=this._handleMessage,this._ws.onerror=function(t){e._handleError(new O.WrappedErrorEvent(t,O.CONNECTION_ERROR,e))})}},{key:"_removeListeners",value:function(){this._ws&&(this._debug("removeListeners"),this._ws.onclose=R,this._ws.onopen=R,this._ws.onerror=R,this._ws.onmessage=R)}},{key:"_wait",value:function(){return new _.default((function(e){setTimeout(e,1e3)}))}},{key:"_heartbeat",value:function(){var e=this;this._beatTimeout&&clearTimeout(this._beatTimeout);!function t(){var n=e._options,o=n.maxHeartbeat,r=void 0===o?S.maxHeartbeat:o,c=n.heartbeatInterval,l=void 0===c?S.heartbeatInterval:c;e._heartbeats>r?e.reconnect(4999,"heartbeat"):(e._ws.send("ping"),e._heartbeats++,e._beatTimeout=setTimeout((function(){t()}),l))}()}},{key:"_inflateMessage",value:function(e){if(e instanceof Blob){var t=new FileReader,n=this;t.addEventListener("loadend",(function(){var e=(0,L.inflate)(t.result,{to:"string"});n._dispatchMessage(e)})),t.onerror=function(e){console.log("mixcopy 解压问题:",e)},t.readAsArrayBuffer(e)}else this._dispatchMessage(e)}},{key:"_dispatchMessage",value:function(e){if("pong"!==e){var data=JSON.parse(String(e)),t=I(data.arg);if("event"in data){if("auth"===data.event){for(;this.onLogin.length;){this.onLogin.pop()(data)}this.onLogin=[],this.isLogin=!0}}else this._listeners.message.forEach((function(e){return e(data,t)}))}}},{key:"_handleError",value:function(e){this._debug("error event",e.message),this._disconnect(void 0,"TIMEOUT"===e.message?"timeout":void 0),this._listeners.error.forEach((function(t){return t(e)})),this._connect()}},{key:"_handleTimeout",value:function(){this._debug("timeout event"),this._handleError(new O.WrappedErrorEvent(null,O.TIMEOUT_ERROR,this))}},{key:"reconnect",value:function(code,e){this._shouldReconnect=!0,this._closeCalled=!1,this._retryCount=-1,this._ws&&this._ws.readyState!==this.CLOSED?(this._disconnect(code,e),this._connect()):this._connect()}},{key:"registerEventListener",value:function(t,n,o){var r=t+String((0,m.default)()),c=this._listeners[t];function l(){var e=Array.prototype.slice.call(arguments);n.apply(void 0,(0,w.default)(e)),o&&c.delete(r)}return c.set(r,l),"open"===t&&this._ws&&this._ws.readyState===e.OPEN&&l(),r}},{key:"close",value:function(){var code=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,e=arguments.length>1?arguments[1]:void 0;this._closeCalled=!0,this._shouldReconnect=!1,this._clearTimeouts(),this._ws?this._ws.readyState!==this.CLOSED?this._ws.close(code,e):this._debug("close: already closed"):this._debug("close enqueued: no ws instance")}},{key:"terminate",value:function(){this.close(1e3,"terminate"),this._debug("execute termination"),e.instance=null,this._init()}},{key:"removeEventListener",value:function(e,t){this._listeners[e].delete(t)}},{key:"send",value:function(data){this._ws&&this._ws.readyState===this.OPEN?this._ws.send(data):(this._debug("enqueue",data),this._messageQueue.push(data))}},{key:"login",value:function(e,t){if(this.isLogin)t({event:"auth",code:0});else{var n=this.onLogin.length;this.onLogin.push(t),0===n&&this.send((0,y.default)({op:"auth",args:[e]}))}}},{key:"subscribe",value:function(e,t,n){var o=function(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?N(Object(source),!0).forEach((function(t){(0,E.default)(e,t,source[t])})):l?h(e,l(source)):N(Object(source)).forEach((function(t){f(e,t,c(source,t))}))}return e}({channel:e,instType:"mc",instId:"default"},t),r=I(o);this._listeners.message.get(r)&&this._listeners.message.delete(r);return this._listeners.message.set(r,(function(e,t){e.arg.instId;t===r&&n(e,t)})),this.send((0,y.default)({op:"subscribe",args:[o]})),r}},{key:"subscribeBFT",value:function(e){var t={channel:"ticker",instType:"sp",instId:"BFTUSDT"},n=I(t);this._listeners.message.get(n)&&this._listeners.message.delete(n);return this._listeners.message.set(n,(function(t,o){var r=t.arg.instId;r&&"BFTUSDT"===r&&o===n&&e(t,o)})),this.send((0,y.default)({op:"subscribe",args:[t]})),n}},{key:"unsubscribe",value:function(e){this._listeners.message.get(e)&&this._listeners.message.delete(e)}},{key:"_debug",value:function(){if(this._options.debug){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];console.log.apply(console,["hero says>"].concat(t))}}},{key:"_clearTimeouts",value:function(){clearTimeout(this._connectTimeout),clearTimeout(this._beatTimeout)}},{key:"_getNextUrl",value:function(e){if("string"==typeof e)return _.default.resolve(e);if("function"==typeof e){var t=e(this._options.compress);if("string"==typeof t)return _.default.resolve(t);if(t.then)return t}throw Error("Invalid URL")}},{key:"selfDestruct",value:function(){this.terminate(),this.urlManager&&this.urlManager.stop()}},{key:"changeProduct",value:function(e){this.productCode=e}},{key:"begin",value:function(){this._connect()}}],[{key:"getInstance",value:function(){if(e.instance)return e.instance;var t=new C.default,n=new e(t.url,S);return e.instance=n,n.urlManager=t,n}},{key:"CONNECTING",get:function(){return 0}},{key:"OPEN",get:function(){return 1}},{key:"CLOSING",get:function(){return 2}},{key:"CLOSED",get:function(){return 3}}]),e}();function I(data){return data?data.channel+data.instId+data.instType:""}(0,E.default)(M,"instance",void 0);var U=M;t.default=U}).call(this,n(414))}}]);
//# sourceMappingURL=e9c5c71ac139c530ee3e.js.map